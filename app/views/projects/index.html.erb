<ul class="project-list">
  <% @projects.each do |project| %>
   <%= render :partial => "projects/project_list", :locals => {:project => project} %>
  <% end %>
  <li>
    <%= link_to "Add New Project #{image_tag('new_project_icon.png', :class=>'new-project-icon')}".html_safe, "javascript:void(0)",  :id => 'btn-new-project', :class => 'project-item' %>
  </li>
</ul>

<%= render "shared/small_modal" %>

<script type="text/javascript">

  $(document).ready(function() {
      $('#btn-new-project').click(function(){
          $.ajax({
              url: "<%= new_project_path() %>",
              type: "get",
              success:function(data) {
                  $('#new-project .modal-body').html(data);
                  $('#new-project .modal-title').html("New Project");
                  $('#new-project').modal('show');
              },
              error: function(){
                  alert('failure');
              }
          });
      });

      $("#btnSave").click(function(){

          if($('input[type=text]').val() ==""){
              $("#errorForName").html("Name cannot be empty.");
              $("#errorForName").css({"color":"red"});
              return false;
          }

          $.ajax({
              url: "<%= projects_path() %>",
              type: "post",
              data: $("#new_project").serialize(),
              success:function(data) {
                  $('#new-project').modal('hide');
                  $('.project-list').prepend(data);
                  popupMessage("Project has been saved successfully", 'info');
              },
              error: function(){
                  popupMessage("Failed to create new project", 'info');
              }
          });
      });
  });

</script>
