<div class="task-details" data-task-id="<%= @task.id %>">
  <ul class="nav nav-tabs task-detail-tab">
    <li class="active"><a href="#general" data-toggle="tab">General</a></li>
    <li><a href="#relation" data-toggle="tab">Relationship</a></li>
    <li><a href="#history" data-toggle="tab">History</a></li>
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
    <div class="task-title">
      <label class="label label-primary"> Task </label>
      <div class="task-name inline"> <%= @task.title %> </div>
    </div>
    <div class="tab-pane active task-details-content-left pull-left" id="general">
      <div class="task-description" contenteditable>
        <%= @task.description %>
      </div>

      <div class="attachment-list">
        <% @task.attachments.each do |attachment| %>
            <% if attachment.file.present? %>
                <%= render :partial => 'task_attachment', :locals => {:attachment => attachment} %>
            <% end %>
        <% end %>
      </div>

      <div class="add-attachment">
        <%= form_for(@attachment, :hrml => {:multipart => true}, :id => "myForm") do |f| %>
            <%= f.file_field(:file, :class => 'file_upload', :data_task_id => @task.id) %>
        <% end %>
      </div>

      <div id="comments">
        <div>
          <b> Comments </b>
        </div>
        <ul class="comments-list reset-padding">
          <% @comments.each do |comment| %>
              <li>
                <%= render :partial => 'shared/comments_item', :locals => {:comment => comment} %>
              </li>
          <% end %>
        </ul>
      </div>

      <div id="write-comments" style="margin-bottom: 10px;">
        <textarea style="" class="form-control jqte-test"></textarea>
        <button type="button" id="btncomment" data-task-id="<%= @task.id %>" class="btn btn-default pull-right"> Done</button>
        <div class="clearfix"></div>
      </div>
    </div>

    <!- Relation Tab content ->

    <div class="tab-pane task-details-content-left pull-left" id="relation">

    </div>

    <!- History Tab content ->

    <div class="tab-pane task-details-content-left pull-left" id="history">
      <ul>
        <% @task.histories.each do |history| %>
            <%= render :partial => 'tasks/history_item', :locals => {:history => history} %>
        <% end %>
      </ul>
    </div>

    <!- Right side bar content ->

    <div class="pull-right task-details-content-right">
      <div class="panel panel-default progress-info">
        <div class="panel-heading">
          <h3 class="panel-title"> Progress</h3>
        </div>
        <div class="panel-body">
          <ul>
            <li>
              <div class="progressbar" style="margin-bottom: 10px;"></div>
            </li>
            <li>
              <label class="info-label"> Effort </label>
              <div class="info-txt progress-effort" contenteditable data-task-field="effort"><%= @task.effort %></div> h
            </li>
            <li>
              <label class="info-label"> Spend </label>
              <div class="info-txt progress-spend" data-task-field="spend" contenteditable><%= @task.spend %></div> h
            </li>
            <li>
              <label class="info-label"> Remaining </label>
              <span class="info-txt progress-remaining"><%= remaining_effort(@task).round(2) %></span> h
            </li>
          </ul>
        </div>
      </div>

      <div class="panel panel-success task-info">
        <div class="panel-heading">
          <h3 class="panel-title">Information</h3>
        </div>
        <div class="panel-body">
          <ul>
            <li>
              <label class="info-label"> Owner </label>
              <span class="info-txt"><%= current_user.name %> </span>
            </li>
            <li>
              <label class="info-label"> Create date</label>
              <span class="info-txt"><%= @task.created_at %> </span>
            </li>
            <li>
              <label class="info-label"> End date</label>
              <span class="info-txt"><%= @task.end_date %> </span>
            </li>
            <li class="priority-list">
              <label class="info-label"> Priority </label>
                 <span class="info-txt task-priority">
                       <%= image_tag("task_#{@task.priority.downcase}.png", :title => 'Priority') %>
                 </span>
                 <ul class="dropdown-menu priority-dropdown">
                    <li class="reset-padding">
                      <a href="javascript:void(0)" class="change-priority" data-task-field="priority" data-value="Low">Low</a>
                    </li>
                    <li class="reset-padding">
                      <a href="javascript:void(0)" class="change-priority" data-task-field="priority" data-value="Medium">Medium</a></li>
                    <li class="reset-padding">
                      <a href="javascript:void(0)" class="change-priority" data-task-field="priority" data-value="High">High</a>
                    </li>
                 </ul>
            </li>
          </ul>
        </div>
      </div>

      <div class="panel panel-default assign-unassign-people">
        <div class="panel-heading">
          <h3 class="panel-title"> Assigned People</h3>
        </div>
        <div class="panel-body assign-people">

          <% @task.users.each do |user| %>
           <span class="assigned-people" data-assigned-id="<%= user.id %>" data-assigned-name="<%= user.name %>">
             <%= image_tag(user.image.present? ? user.image_url(:small_thumb) : 'default_user_icon.png', :id => user.id, :class => 'nav-avatar') %>
           </span>
          <% end %>
          <span class="assigned-new-people">
             <%= image_tag("new_project_icon.png",:class => 'nav-avatar') %>
          </span>
          <ul class="assigned-people-list dropdown-menu" id="assigned-list">
            <% @rest = rest_of_users(@task.users, @project.users) %>
            <% @rest.each do |user| %>
                <li> <a href="javascript:void(0)" class="assigned-in-task" data-value="<%= user.id %>" ><%= user.name %></a></li>
            <% end %>
          </ul>

          <div class="unassigned-pophover">
            <a href="javascript:void(0);"  class="unassigned-people" data-assigned-value="" data-name=""> Unassigned </a>
          </div>

        </div>
      </div>
    </div>
    <div class="clearfix"></div>
  </div>
  <div class="clearfix"></div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $('.jqte-test').jqte();

        $(".progressbar").progressbar({
            value: 50
        });
    });

    $(document).on("mouseover", ".comments-list li",function(){
        $(this).find(".comments-reply").removeClass('hidden');
    });

    $(document).on("mouseout", ".comments-list li",function(){
        $(".comments-reply").addClass('hidden');
    });

    $(document).off("click", ".reply").on("click", ".reply", function() {
        $(".reply-wrapper, .edit-wrapper").remove();
        $(this).parent().before("<%= escape_javascript(render :partial => 'shared/reply', :locals => {:task => @task} )%>");
    });

    $(document).off("click", ".edit").on("click", ".edit", function() {
        $(".edit-wrapper, .reply-wrapper").remove();
        $(this).parent().before("<%= escape_javascript(render :partial => 'shared/edit', :locals => {:task => @task})%>");
        comments_id = $(this).attr('id');
        edit_context = $(this).parents('.comments-item-wrapper').find('.content-right').html();
        $(this).parents('.comments-item-wrapper').find('.jqte_editor').html(edit_context);
        $("#editbtn").attr('data-comments-id', comments_id);
    });
</script>